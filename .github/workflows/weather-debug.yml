name: Debug Weather Page Structure
on: 
  workflow_dispatch  # ä»…å…è®¸æ‰‹åŠ¨è§¦å‘ï¼Œç”¨äºæµ‹è¯•

permissions:
  contents: write

jobs:
  debug-weather-page:
    runs-on: ubuntu-latest
    steps:
      - name: 1. æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: 2. å®‰è£…Pythonä¾èµ–
        run: pip3 install requests beautifulsoup4

      - name: 3. æŠ“å–å¹¶ä¿å­˜ç½‘é¡µå¿«ç…§
        run: |
          python3 << 'EOF'
          import requests
          url = "https://tianqi.moji.com/weather/china/sichuan/longquanyi-district"
          headers = {'User-Agent': 'Mozilla/5.0'}
          try:
              r = requests.get(url, headers=headers, timeout=30)
              r.raise_for_status()
              with open("debug_weather_page.html", "w", encoding="utf-8") as f:
                  f.write(r.text)
              print("âœ… æˆåŠŸï¼šå·²ä¿å­˜ç½‘é¡µå¿«ç…§åˆ° debug_weather_page.html")
              print(f"ğŸ“„ æ–‡ä»¶å¤§å°ï¼š{len(r.text)} å­—ç¬¦")
          except Exception as e:
              print(f"âŒ å¤±è´¥ï¼š{e}")
          EOF

      - name: 4. æäº¤è°ƒè¯•æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add debug_weather_page.html
          git commit -m "Add weather debug page snapshot" || echo "æ²¡æœ‰æ–°å˜æ›´ï¼Œæ— éœ€æäº¤"
          git push
